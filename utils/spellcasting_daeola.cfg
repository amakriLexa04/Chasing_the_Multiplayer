#textdomain wesnoth-ctl

#######################################################################################################################################################
#----------------------------------------------------------------- "PRIVATE" MACROS -------------------------------------------------------------------
#######################################################################################################################################################
#                                                                   GROUP 0 SKILLS
#######################################################################################################################################################

#############################
# MAGIC MISSILE
#############################
#define EVENT_MAGIC_MISSILE_D
    [event]
        name=refresh_skills
        first_time_only=no
		{CHECK_EQUIPPED_SPELL id=$current_caster skill_magic_missile_d}
		[if] {VARIABLE_CONDITIONAL equipped_spell_found equals yes} {THEN(
        [object]
            id,take_only_once=skill_magic_missile_d,no {FILTER id=$current_caster}
            {EFFECT new_attack (
                name,description,icon=missile,_"missile",attacks/magic-missile.png
                range,type,damage,number=ranged,fire,7,3
                [specials]
                    {WEAPON_SPECIAL_MAGICAL}
                [/specials] )}
            [/object]
		)} [/if]
    [/event]
#enddef

#######################################################################################################################################################
#                                                                   GROUP 1 SKILLS
#######################################################################################################################################################

#############################
# LEVITATE
#############################
#define EVENT_LEVITATE
    [event]
        name=skill_levitate
        first_time_only=no
        {ANIMATE_UNIT id=$current_caster skill_levitate}
        [modify_unit]
            {FILTER id=$current_caster}
            [object]
                duration,id=turn,skill_levitate
                {EFFECT new_ability ([abilities]
                    [skirmisher]
                        id,affect_self=skirmisher,yes
                    [/skirmisher]
                [/abilities])}
                {EFFECT defense (replace=yes
                    [defense]
                        {FLY_DEFENSE -50} # 50% hit-chance on all terrain
                    [/defense])}
                {EFFECT movement_costs (replace=yes
                    [movement_costs]
                        {FLY_MOVE} # fast movement on most terrains
                    [/movement_costs])}
            [/object]
        [/modify_unit]
	[/event]
	# kill casters if they were levitating over unwalkable terrain, and is now unable to move
    [event]
        name=turn refresh,skill_levitate_cancel
		first_time_only = no
        [lua]
            code= <<
			    local _ = wesnoth.textdomain "wesnoth-ctl"
                local units = wesnoth.units.find_on_map()
                
                for i,u in ipairs(units) do
                    if  wml.variables["caster_" .. u.id] and wml.variables["side_number"] == u.side then
                        wml.fire.remove_object {
                            object_id = "skill_levitate",
    						id = u.id
                        }
						local u_temp = wesnoth.units.find_on_map{ id = u.id, defense = 100}[1]
						if u_temp then
                            wml.fire.message {
                                speaker = u.id,
                                message = _"My levitate spell has ended over impassable terrain! I’m falling to my death!"
                            }
                            wml.fire.kill {
                                id = u.id,
                                animate = true,
                                fire_event = true
                            }
                        end
                        u_temp = nil							
                    end
                end
    			
                units = nil
    	    >>
    	[/lua]
    [/event]
    [event]
        name=refresh_skills
        first_time_only=no
    	{CHECK_EQUIPPED_SPELL id=$current_caster skill_levitate}
        [if] {VARIABLE_CONDITIONAL equipped_spell_found not_equals yes} {THEN(
            {FIRE_EVENT skill_levitate_cancel}
    	)} [/if]
    [/event]
#enddef


#############################
# SWAP
#############################
#define EVENT_SWAP_D

    [event]
        name=skill_swap_cast
        first_time_only=no

        ##adding swap immmunity
        [if]
            [have_unit]
                x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                [not]
                    type=utility_unit
                [/not]
            [/have_unit]
            [then]
                [animate_unit]
                    flag=pre_teleport
                    [filter]
                        id=$current_caster
                    [/filter]
                [/animate_unit]

                [put_to_recall_list]
                    id=$current_caster
                [/put_to_recall_list]
                [redraw][/redraw]

                [teleport]
                    [filter]
                        x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                    [/filter]
                    x,y=$unit_to_modify_x, $unit_to_modify_y
                    animate=yes
                [/teleport]

                [recall]
                    id=$current_caster
                    x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                    show=no
                [/recall]

                [animate_unit]
                    flag=post_teleport
                    [filter]
                        id=$current_caster
                    [/filter]
                [/animate_unit]
                [redraw][/redraw]

                {FIRE_EVENT swap_trial_achievement}
				{FIRE_EVENT skill_swap_succesful_s4}
            [/then]
            [else]
                [lua]
                    code= <<
			    local unit_to_modify = wesnoth.get_units({ id = "$current_caster" })[1]
		        unit_to_modify.experience = unit_to_modify.experience + 8
                wesnoth.set_variable("caster_" .. wml.variables["$current_caster"] .. ".spellcasted_this_turn", nil) --не тестив
		    >>
                [/lua]
            [/else][/if]
        [/event]

        [event]
            name=skill_swap
            first_time_only=no

			{CTL_RANGED_SPELL "$current_caster" 4 "misc/swap.png" "all" true "skill_swap_cast" 0 8}
        [/event]
#enddef

#############################
# DIS_HEAL
#############################
#define EVENT_DISHEAL_D

    [event]
        name=skill_disheal_cast
        first_time_only=no

        [if]
            [not]
                [variable]
                    name="unit_to_cast_on_x"
                    equals=$unit_to_modify_x
                [/variable]
                [and]
                    [variable]
                        name="unit_to_cast_on_y"
                        equals=$unit_to_modify_y
                    [/variable]
                [/and]
                [and]
                    [have_unit]
                        id=temple_guard_1
                    [/have_unit]
                [/and]
            [/not]
            [then]
                [animate_unit]
                    flag=healing
                    [filter]
                        id=$current_caster
                    [/filter]
                [/animate_unit]

                [animate_unit]
                    flag=levelin
                    [filter]
                        x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                    [/filter]
                [/animate_unit]

                [heal_unit]
                    [filter]
                        x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                    [/filter]
                    amount=8
                    animate=yes
                [/heal_unit]

                [if]
                    [variable]
                        name="is_daeola_healed_exam_mage"
                        equals=false
                    [/variable]
                    [then]
                        {FIRE_EVENT heal_exam_mage}
                    [/then][/if]
					
				[if]
                    [variable]
                        name="caves_cursed_heal_activate"
                        equals=true
                    [/variable]
                    [then]
                        {FIRE_EVENT heal_cursed_islefolk}
                    [/then][/if]
                [/then]
                [else]
                    [message]
                        speaker=daeola
						#po: Ні, я не можу вилікувати себе закляттям, тільки не зараз! Я не відмовлюся від своєї обіцянки — я носитиму свій шрам, поки не стану справжнім магом!
                        message= _ "No, I can't heal myself with a spell, not now! I won't go back on my promise — I'll wear my scar until I'm a real mage!"
                    [/message]
					
					[modify_unit]
                    [filter]
                    id=daeola
                    [/filter]
                    experience = "$($unit.experience + 6)"
                    [/modify_unit]
					[lua]
                        code= <<
                            wesnoth.set_variable("caster_" .. wml.variables["$current_caster"] .. ".spellcasted_this_turn", nil) --не тестив
		                >>
                    [/lua]
                [/else][/if]
            [/event]

            [event]
                name=skill_disheal
                first_time_only=no

				{CTL_RANGED_SPELL "$current_caster" 7 "misc/buff.png" true false "skill_disheal_cast" 0 6}
            [/event]
#enddef

#############################
# DIS_ATTACK
#############################
#define EVENT_DISATTACK_D

    [event]
        name=skill_disattack_cast
        first_time_only=no

        [set_variable]
            name=repeat_count
            value=3
        [/set_variable]

        [while]
            [variable]
                name=repeat_count
                greater_than=0
            [/variable]
            [and]
                [have_unit]
                    x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                [/have_unit]
            [/and]

            [do]
                [set_variable]
                    name=miss_or_hit_disattack
                    value=9
                [/set_variable]

                {RANDOM 1..100}
                [if]
                    [variable]
                        name="random"
                        less_than=70
                    [/variable]
                    [then]
                        [set_variable]
                            name=miss_or_hit_disattack
                            value=9
                        [/set_variable]
                        [sound]
                            name= {SOUND_LIST:HOLY}
                            start_time=0
                        [/sound]
                    [/then]
                    [else]
                        [set_variable]
                            name=miss_or_hit_disattack
                            value=0
                        [/set_variable]
                        [sound]
                            name={SOUND_LIST:HOLY_MISS}
                            start_time=0
                        [/sound]
                    [/else][/if]

                    [animate_unit]
                        flag=disattack_anim
                        [filter]
                            id=$current_caster
                        [/filter]

                        [facing]
                            x,y=$unit_to_cast_on_x,$unit_to_cast_on_y
                        [/facing]
                    [/animate_unit]

                    [object]
                        silent=yes
                        duration=turn end
                        [filter]
                            x,y=$unit_to_cast_on_x, $unit_to_cast_on_y
                        [/filter]
                        [effect]
                            apply_to=new_animation
                            [extra_anim]
                                flag=disattack_anim_defender
                                missile_start_time=-150
                                [missile_frame]
                                    halo="halo/holy/light-beam-[1~7,6~1].png:[30*6,130,70*6]"
                                    offset=0.0
                                    auto_vflip=no
                                [/missile_frame]
                            [/extra_anim]
                        [/effect]
                    [/object]

                    [animate_unit]
                        flag=disattack_anim_defender
                        [filter]
                            x,y=$unit_to_cast_on_x, $unit_to_cast_on_y
                        [/filter]
                        [facing]
                            id=$current_caster
                        [/facing]
                    [/animate_unit]

                    [harm_unit]
                        [filter]
                            x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                        [/filter]
                        [filter_second]
                            id=$current_caster
                        [/filter_second]
                        amount=$miss_or_hit_disattack
                        alignment=lawful
                        damage_type=arcane
                        kill=yes
                        experience=kill
                        fire_event=yes
                        animate=defender

                        [primary_attack]
                            range=ranged
                        [/primary_attack]

                        [secondary_attack]
                            range=ranged
                        [/secondary_attack]
                    [/harm_unit]

                    [set_variable]
                        name=repeat_count
                        add=-1
                    [/set_variable]

                    ##{DELAY 500}
                [/do]
            [/while]

            [if]
                [have_unit]
                    x,y= $unit_to_cast_on_x, $unit_to_cast_on_y
                [/have_unit]
                [then]
                    [store_unit]
                        [filter]
                            x,y=$unit_to_cast_on_x,$unit_to_cast_on_y
                        [/filter]
                        variable=unit_to_cast_on
                    [/store_unit]
                    {VARIABLE unit_level $unit_to_cast_on.level}
                    {CLEAR_VARIABLE unit_to_cast_on}
                    [store_unit]
                        [filter]
                            id=$current_caster
                        [/filter]
                        variable=attacker_var
                    [/store_unit]
                    [modify_unit]
                        [filter]
                            id=$current_caster
                        [/filter]
                        experience="$($attacker_var.experience + $unit_level)"
                    [/modify_unit]
					{CLEAR_VARIABLE attacker_var}
                [/then]
            [/if]
        [/event]

        [event]
            name=skill_disattack
            first_time_only=no

            {VARIABLE TARGET_IMAGE "misc/attack.png"}
			
			{CTL_RANGED_SPELL "$current_caster" 6 "misc/attack.png" false true "skill_disattack_cast" 0 8}
        [/event]
#enddef

#############################
# WARD
#############################
#define EVENT_WARD_D

    [event]
        name=skill_ward_cast
        first_time_only=no
        {EVENT_SUMMON_CAST "$current_caster" Brazier}
		
		[modify_unit]
		[filter]
		x,y=$unit_to_cast_on_x, $unit_to_cast_on_y
		[/filter]
		[status]
		unhealable=yes
		[/status]
		upkeep=loyal
		[/modify_unit]
    [/event]

    [event]
        name=skill_ward
        first_time_only=no

		{CTL_ADJACENT_SPELL "$current_caster" 2 "misc/summon.png" true "skill_ward_cast" 0 12}

    [/event]
	
	[event]
    name=victory
    {KILL (side,type_adv_tree=1,Brazier)} # kill at the end of every scenario
[/event]
#enddef

#define ONEANIM_DANCING_DAGGERS A B C D
    [attack_anim]
        {FILTER_ATTACK name="dancing daggers"}
        start_time=-350         {FRAME image={PATH}/haralin-leading.png:350}
        overlay_start_time=-350 {OVERLAY_FRAME x,y,image=0,-30,"halo/elven/faerie-fire-halo[1~7].png~SCALE(48,48):75"}
        missile_start_time=-300
        missile2_start_time=-250
        missile3_start_time=-200
        [missile_frame]
            duration,offset,x,y=150,0~0.8,{A}2~{B}2,-15~7
            image="projectiles/dagger-n.png"
            image_diagonal="projectiles/dagger-ne.png"
        [/missile_frame]
        [missile2_frame]
            duration,offset,x,y=150,0~0.8,{C}2~{D}2,-25~-7
            image="projectiles/dagger-n.png"
            image_diagonal="projectiles/dagger-ne.png"
        [/missile2_frame]
        [missile3_frame]
            duration,offset,x,y=150,0~0.8,0~0,-20~0
            image="projectiles/dagger-n.png"
            image_diagonal="projectiles/dagger-ne.png"
        [/missile3_frame]
        {SOUND:HIT_AND_MISS throwing-knife.ogg throwing-knife-miss.ogg -200}
    [/attack_anim]
#enddef
#define ANIMATIONS_LIGHTNING_SINGLEBOLT DIRECTION_NUMBER PATH
    [attack_anim]
        {FILTER_ATTACK name=lightning}
        {LIGHTNING_BOLT {DIRECTION_NUMBER} }
        start_time=-300
        {FRAME image={PATH}/haralin.png:50}
        {FRAME image={PATH}/haralin-ranged[1,2,1].png:[125,225,75]}
        {FRAME image={PATH}/haralin.png:75}
        {SOUND:HIT_AND_MISS lightning.ogg lightning-miss.ogg -300}
    [/attack_anim]
#enddef

#######################################################################################################################################################
#                                                                  "PUBLIC" MACROS
#######################################################################################################################################################
#############################
# GLOBAL EVENTS
#############################

#define EVENT_REMOVE_SKILLS_DAEOLA
    [event]
        name=refresh_skills
        first_time_only=no
        {REMOVE_OBJECT skill_magic_missile_d   id=$current_caster}
        {REMOVE_OBJECT skill_levitate        id=$current_caster}
    [/event]
#enddef
#define GLOBAL__SPELLCASTING_EVENTS_DAEOLA
    {EVENT_REMOVE_SKILLS_DAEOLA} # create this event first, so we remove and THEN re-add

    {EVENT_MAGIC_MISSILE_D}
    {EVENT_LEVITATE}
    {EVENT_SWAP_D}
    {EVENT_DISHEAL_D}
    {EVENT_DISATTACK_D}
	{EVENT_WARD_D}
	
#############################
# ANIMATIONS
#############################
    [event]
	name=magic_system_add_animations
	first_time_only=no
	
	[store_unit]
	    [filter]
            id=$current_caster
        [/filter]
		variable=current_caster_image
	[/store_unit]
	
	[store_side]
	    [filter]
            id=$current_caster
        [/filter]
		variable=current_caster_side
	[/store_side]

	[object]
        take_only_once=no
		id=magic_system_animations
        duration=forever
        [filter]
            id=$current_caster
        [/filter]
        [effect]
            apply_to=new_animation
			#--------------------
            # MAGIC MISSILE ANIMATION
            #--------------------
            [attack_anim]
			    base_score=-1
                {FILTER_ATTACK name=missile}
                offset=0
                {MAGIC_MISSILE 11 -20}
                {MAGIC_MISSILE_STAFF_FLARE -750 600 11 -20}
                start_time=-800
                {FRAME image=$current_caster_image.image:[100,700,200]}
                {SOUND:HIT_AND_MISS magic-missile-[1~3].ogg magic-missile-[1~3]-miss.ogg -350}
            [/attack_anim]
			#--------------------
            # LEVITATE ANIMATION
            #--------------------
            [animation]
			    base_score=98
                apply_to=skill_levitate
                {SOUND_FRAME sound=skill-levitate.wav}
                {FRAME image="$current_caster_image.image~ADJUST_ALPHA(if(alpha<=200,alpha*0,alpha)):[50,300,50]"}
                {FRAME submerge,image=0.01,"units/daeola/L2/daeola-shadow.png~BLIT($current_caster_image.image~ADJUST_ALPHA(if(alpha<=200,alpha*0,alpha))~RC(magenta>$current_caster_side.color),0,-[1,2,3,4]):[100,150,200,250]"}
                {OVERLAY_FRAME halo=halo/saurian-magic-halo-[1~7].png:75}
            [/animation]
            [standing_anim]
			    base_score=98
                {FILTER_OBJECT_ID skill_levitate}
                {FRAME submerge,image=0.01,"units/daeola/L2/daeola-shadow.png~BLIT($current_caster_image.image~ADJUST_ALPHA(if(alpha<=200,alpha*0,alpha))~RC(magenta>$current_caster_side.color),0,-[4~1,2~8,8~5,5,5~8,8~5]):350"}
            [/standing_anim]
            [movement_anim]
			    base_score=98
                {FILTER_OBJECT_ID skill_levitate}
                {FRAME submerge,image=0.01,"units/daeola/L2/daeola-shadow.png~BLIT($current_caster_image.image~ADJUST_ALPHA(if(alpha<=200,alpha*0,alpha))~RC(magenta>$current_caster_side.color),0,-4):200"}
            [/movement_anim]
			#--------------------
            # DISATTACK ANIMATION
            #--------------------
	        [animation]
			    base_score=98
                apply_to=disattack_anim
                start_time=-395
                [frame]
                    image="$current_caster_image.image:75"
                [/frame]
                [frame]
                    image="$current_caster_image.image"
                    halo=halo/holy/halo[6,1,3,5,6].png:[75*4,50]
                [/frame]
                {SOUND:HIT_AND_MISS {SOUND_LIST:HOLY} {SOUND_LIST:HOLY_MISS} -75}
                [frame]
                    image="$current_caster_image.image:50"
                [/frame]
            [/animation]
			#--------------------
            # MAGIC BLAST ANIMATION
            #--------------------
			[attack_anim]
				base_score=-1
                {FILTER_ATTACK (name=magic_blast)}
	        
                start_time=-350
                missile_start_time=-100
                halo_start_time=-250
	        
                [missile_frame]
                    duration=200
                    image="projectiles/darkmissile-n.png"
                    image_diagonal="projectiles/darkmissile-ne.png"
                [/missile_frame]
	        
                {FRAME image={PATH}/haralin.png:[100,700,200]}
	        
                [halo_frame]
                    halo="halo/undead/dark-magic-[1~6].png~O(35%):50"
                    halo_y=10
                    halo_x=5
                    auto_vflip=no
                [/halo_frame]
	        
                {SOUND:HIT_AND_MISS magic-dark.ogg magic-dark-miss.ogg -100}
            [/attack_anim]
			#--------------------
            # BEND ANIMATION
            #--------------------
			[animation]
                apply_to=skill_bend_cast
                {SOUND_FRAME sound=rumble.ogg}
                {FRAME image={PATH}/haralin.png:[50,300,50]}
	        	{MISSILE_FRAME_ICE}
                {OVERLAY_FRAME halo=halo/saurian-magic-halo-[1~7].png:75}
            [/animation]
			#--------------------
            # SHIELD ANIMATION
            #--------------------
			[animation]
                apply_to=skill_shield
                {SOUND_FRAME sound=skill-shield.wav}
                {FRAME image={PATH}/haralin.png:[50,300,50]}
                {OVERLAY_FRAME halo="halo/merfolk/water-halo-[7~1].png~CS(255,255,255)~O(0.8):75"}
                {OVERLAY_FRAME (y,image=-2,halo/shield.png:300
                alpha=0.6~1.0, 1.0, 1.0~0.6)}
            [/animation]
            [standing_anim]
                {FILTER_OBJECT_ID skill_shield}
                {OVERLAY_FRAME (y,image=-2,halo/shield.png:3500
                alpha=0.5:250, 0.5~0.3:1500, 0.3:250, 0.3~0.5:1500)}
            [/standing_anim]
            [movement_anim]
                {FILTER_OBJECT_ID skill_shield}
                {OVERLAY_FRAME (y,image=-2,halo/shield.png:200
                alpha=0.4
                offset="0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200")}
            [/movement_anim]
            [defend]
                {FILTER_OBJECT_ID skill_shield}
                start_time=-175
                {FRAME( image={PATH}/haralin.png:50,{PATH}/haralin.png:250,{PATH}/haralin.png:50
                halo_y,halo=-2,"halo/shield.png~O(0.4,0.8,1.0,0.9,0.8,0.6,0.4]):50")}
                [if]
                    hits=hit
                    overlay_start_time=-25 {OVERLAY_FRAME sound={SOUND_LIST:HUMAN_HIT}}
                [/if]
            [/defend]
			#--------------------
            # STASIS ANIMATION
            #--------------------
			[animation]
                apply_to=skill_stasis
                {SOUND_FRAME sound=skill-stasis.wav}
                {FRAME image={PATH}/haralin.png:[100,350,100]}
                {FRAME image={PATH}/haralin.png:[150]}
                {OVERLAY_FRAME  halo="halo/stasis/mystic-magic[1~6,4].png~CS(-255,-255,-255)~O(0.2)~SCALE(60,60):[100*7]"}
                {OVERLAY2_FRAME halo="halo/stasis/mysticaltoad-magic[1~6,4].png~CS(-255,-255,-255)~O(0.15)~SCALE(180,180):[100*7]"}
            [/animation]
			#--------------------
            # CHILL TOUCH ANIMATION
            #--------------------
			[attack_anim]
                {FILTER_ATTACK (name=chill touch)}
                start_time=-250
                {FRAME image={PATH}/haralin.png:50}
                {FRAME image={PATH}/haralin.png:[100,200]}
                {SOUND:HIT_AND_MISS staff.ogg staff-miss.ogg -125}
                {FRAME image={PATH}/haralin.png:50}
                {FRAME image={PATH}/haralin.png:50}
                overlay_start_time=-250
                {OVERLAY_FRAME halo="halo/elven/nature-halo[1~8].png~CS(-10,-10,20)~O(0.3):[60*8]"}
            [/attack_anim]
			#--------------------
            # FIREBALL ANIMATION
            #--------------------
			[attack_anim]
                {FILTER_ATTACK name=fireball}
                offset=0
                {MISSILE_FRAME_FIREBALL_XY 11 -20}
                start_time=-575
                {FRAME image={PATH}/haralin.png:50}
                {FRAME image={PATH}/haralin.png:[100,150,75]}
                {FRAME image={PATH}/haralin.png:75}
                {SOUND:HIT_AND_MISS fire.wav fire.wav -375}
            [/attack_anim]
			#--------------------
            # ENERVATE ANIMATION
            #--------------------
			[attack_anim]
                {FILTER_ATTACK name=enervate}
                start_time=-350
                {FRAME sound,image=siphon.ogg,{PATH}/haralin.png:[50,400,50]}
                overlay_start_time=-350
                {OVERLAY_FRAME  offset,halo=1.0,"halo/elven/nature-halo[8~1].png~CS(50,-30,-50)~O([80%*2,60%,40%,30%,20%*3]):75"}
                [if]
                    hits=yes
                    overlay2_start_time=-200
                    {OVERLAY2_FRAME offset,halo=0.0,"halo/elven/nature-halo[1~8].png~CS(50,-30,-50)~O([20%*3,30%,40%,60%,80%*2]):75"}
                    missile_start_time=-200
                    [missile_frame]
                        image="halo/elven/druid-healing[8~1].png~CS(50,-30,-50):50"
                        offset=1.0~0.0
                    [/missile_frame]
                [/if]
                [else]
                    hits=no
                    missile_start_time=-200
                    [missile_frame]
                        image="halo/elven/druid-healing[8~1].png~CS(50,-30,-50):50"
                        offset=1.0~0.8
                        alpha=1.0~0.0
                    [/missile_frame]
                [/else]
            [/attack_anim]
			#--------------------
            # BLIZZARD ANIMATION
            #--------------------
			[animation]
                apply_to=skill_blizzard
                {SOUND_FRAME sound=skill-blizzard.wav}
                {FRAME image={PATH}/haralin-ranged1.png:100}
                {OVERLAY_FRAME halo="halo/blizzard/[0001~0004].png~CS(150,150,150)~SCALE(144,144):25"}
            [/animation]
            [standing_anim]
                {FILTER_OBJECT_ID skill_blizzard_animation}
                {FRAME image={PATH}/haralin-ranged2.png}
                {OVERLAY_FRAME halo="halo/blizzard/[0004~0130].png~CS(150,150,150)~SCALE(144,144):25"}
            [/standing_anim]
            [animation]
                apply_to=skill_blizzard_end
                {FRAME image={PATH}/haralin-ranged1.png:100}
            [/animation]
			#--------------------
            # COUNTERSPELL ANIMATION
            #--------------------
			[standing_anim]
                {FILTER_OBJECT_ID skill_counterspell_casting}
                sound_start_time=-1250   {SOUND_FRAME sound=skill-counterspell.wav}
                start_time=-1250         {FRAME image={PATH}/haralin.png:[150,950,150]}
                overlay_start_time=-900  {OVERLAY_FRAME (image=halo/counterspell/counterspell-aoe.png:900
                auto_hflip,alpha=no,0~1)}
                overlay2_start_time=-900 {OVERLAY2_FRAME (image="halo/counterspell/ucircle-b-[12~23].png~SCALE(120,70):75"
                auto_hflip,alpha=no,0~0.6)}
                overlay3_start_time=-600 {OVERLAY3_FRAME (image="halo/counterspell/ucircle-b-[14~07].png~SCALE(180,105)~CS(-25,-25,-25):75"
                auto_hflip,alpha=no,0~0.4)}
                overlay4_start_time=-300 {OVERLAY4_FRAME (image="halo/counterspell/ucircle-b-[07~10].png~SCALE(264,154)~CS(-100,-100,-100):75"
                auto_hflip,alpha=no,0~0.2)}
            [/standing_anim]
            [movement_anim]
                {FILTER_OBJECT_ID skill_counterspell}
                {OVERLAY_FRAME (auto_hflip,image=no,halo/counterspell/counterspell-aoe.png
                offset=0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200 )}
                {OVERLAY2_FRAME (auto_hflip,alpha,image=no,0.6,"halo/counterspell/ucircle-b-[12~23].png~SCALE(120,70):75"
                offset=0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200 )}
                {OVERLAY3_FRAME (auto_hflip,alpha,image=no,0.4,"halo/counterspell/ucircle-b-[14~07].png~SCALE(180,105)~CS(-25,-25,-25):75"
                offset=0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200 )}
                {OVERLAY4_FRAME (auto_hflip,alpha,image=no,0.2,"halo/counterspell/ucircle-b-[07~10].png~SCALE(264,154)~CS(-100,-100,-100):75"
                offset=0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200 )}
            [/movement_anim]
			#--------------------
            # POLYMORPH ANIMATION
            #--------------------
			[animation]
                apply_to=skill_polymorph
                start_time=-100
                {FRAME image={PATH}/haralin.png:50}
            [/animation]
			#--------------------
            # DANCING DAGGERS ANIMATION
            #--------------------
			{ONEANIM_DANCING_DAGGERS -  -  () ()}
            {ONEANIM_DANCING_DAGGERS () () -  - }
            {ONEANIM_DANCING_DAGGERS -  () ()  -}
            {ONEANIM_DANCING_DAGGERS () -  -  ()}
			#--------------------
            # ILLUSION ANIMATION
            #--------------------
			[animation]
                apply_to=skill_illusion
                sound_start_time   =-600 {SOUND_FRAME    sound=skill-illusion.wav}
                overlay_start_time =-400 {OVERLAY_FRAME  alpha,image=0.05~0.80,"units/drakes/armageddon.png~MASK(masks/teleport-mask-[9~0].png):100"}
	        
                overlay2_start_time=-600 {OVERLAY2_FRAME (halo_x,halo_y,halo= 10,-30~30,halo/teleport-[9,8,1~9].png:75)}
                overlay3_start_time=-400 {OVERLAY3_FRAME (halo_x,halo_y,halo=  0,-40~40,halo/teleport-[9,8,1~9].png:75)}
                overlay4_start_time=-200 {OVERLAY4_FRAME (halo_x,halo_y,halo=-10,-30~30,halo/teleport-[9,8,1~9].png:75)}
	        
                overlay5_start_time=-400 {OVERLAY5_FRAME auto_hflip,alpha,image=no,0~1,"halo/terror/terrorCW-[ 11~20].png~O(0.10)~CS(252,174,30):100"}
                overlay6_start_time=-400 {OVERLAY6_FRAME auto_hflip,alpha,image=no,0~1,"halo/terror/terrorCCW-[40~45].png~O(0.10)~CS(225,225,0)~FL():175"}
                overlay7_start_time=-400 {OVERLAY7_FRAME auto_hflip,alpha,image=no,0~1,"halo/terror/terrorCCW-[36~45].png~O(0.10)~CS(252,215,0):10"}
            [/animation]
            [movement_anim]
                base_score=99 # if we have multiple active spells with movement animations, prefer illusion's since it's the most obvious
                {FILTER_OBJECT_ID skill_illusion}
                {OVERLAY_FRAME (image="units/drakes/armageddon.png~O(0.4):200"
                offset=0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200,0~1:200 )}
            [/movement_anim]
			#--------------------
            # LIGHTNING ANIMATION
            #--------------------
			{ANIMATIONS_LIGHTNING_SINGLEBOLT 1 {PATH}}
            {ANIMATIONS_LIGHTNING_SINGLEBOLT 2 {PATH}}
            {ANIMATIONS_LIGHTNING_SINGLEBOLT 3 {PATH}}
			#--------------------
            # TIME DILATION ANIMATION
            #--------------------
			[standing_anim]
                {FILTER_OBJECT_ID skill_time_dilation_casting}
                sound_start_time   =-3600 {SOUND_FRAME     sound=skill-time-dilation.wav}
                start_time         =-3600 {FRAME           image={PATH}/haralin-ranged[1,2,1].png:[100,3600,100]}
                overlay_start_time =-3600 {OVERLAY_FRAME  (x,y,image=   0,   0, "halo/time-dilation/[0001~0072].png:50")}
                overlay2_start_time=-3250 {OVERLAY2_FRAME (x,y,image=-150,  75, "halo/time-dilation/[0001~0072].png~SCALE(108,108)~O(0.7):45")}
                overlay3_start_time=-2900 {OVERLAY3_FRAME (x,y,image= 110,  80, "halo/time-dilation/[0001~0072].png~SCALE(144,144)~O(0.7):40")}
                overlay4_start_time=-2500 {OVERLAY4_FRAME (x,y,image= -40,-130, "halo/time-dilation/[0001~0072].png~SCALE(124,124)~O(0.7):35")}
            [/standing_anim]
			#--------------------
            # CATACLYSM ANIMATION
            #--------------------
			[standing_anim]
                {FILTER_OBJECT_ID skill_cataclysm_casting}
                sound_start_time   =-1400 {SOUND_FRAME    sound=skill-cataclysm.wav}
                start_time         =-1800 {FRAME          image={PATH}/haralin-ranged[1,2].png:[100,1900]}
                overlay_start_time =-1800 {OVERLAY_FRAME  alpha,image=0~1.0,"halo/cataclysm/[0001~0024].png:75"}
                overlay2_start_time= -600 {OVERLAY2_FRAME alpha,image=0~1.0,"halo/cataclysm/cataclysm00-[1~6,1~6].png~CS(-100,-255,-255):50"}
            [/standing_anim]
            [standing_anim]
                {FILTER_OBJECT_ID skill_cataclysm_casted}
                {OVERLAY_FRAME  y,alpha,image=72,0.6~0.0,"halo/cataclysm/sphere/[0001~0024,0001~0024].png~SCALE(800,800)~CS(-100,-100,-100):50"}
                {OVERLAY_FRAME  image=misc/blank-hex.png:99999}
	        
                {OVERLAY2_FRAME yalpha,image=-10,5~0,"halo/cataclysm/explosion/[1~9].png~SCALE(500,500)~CS(-100,-255,-255):100"}
                {OVERLAY2_FRAME image=misc/blank-hex.png:99999}
            [/standing_anim]
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			
			#--------------------
            # DEFAULT ANIMATIONS
            #--------------------
            [leading_anim]
			    base_score=-1 # avoid using this animation if any others apply
                start_time=-250          {FRAME image=$current_caster_image.image:500}
                overlay_start_time=-100  {OVERLAY_FRAME halo_x,halo_y,halo=14,-25,halo/misc/leadership-flare-[1~13].png:20}
            [/leading_anim]
            [recruiting_anim]
			    base_score=-1 # avoid using this animation if any others apply 
                start_time=-250          {FRAME image=$current_caster_image.image:500}
                overlay_start_time=-100  {OVERLAY_FRAME halo_x,halo_y,halo=14,-25,halo/misc/leadership-flare-[1~13].png:20}
            [/recruiting_anim]
			#--------------------
            # HEALING ANIMATION
            #--------------------
	        [healing_anim]
	            base_score=-1 # avoid using this animation if any others apply 
                start_time=-525
                [frame]
                    image="$current_caster_image.image:75"
                [/frame]
                [frame]
                    image="$current_caster_image.image"
                    halo=halo/holy/halo[6,1~6].png:75
                [/frame]
                [frame]
                    image="$current_caster_image.image:75"
                [/frame]
            [/healing_anim]
			#--------------------
            # PRE-TELEPORT ANIMATION
            #--------------------
            [animation]
	            base_score=-1 # avoid using this animation if any others apply 
                apply_to=pre_teleport
                start_time=-1200
	        
                teleport_sparkle_1_start_time=-1200
                teleport_sparkle_2_start_time=-1000
                teleport_sparkle_3_start_time=-800
	        
                [teleport_sparkle_1_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=-10
                    halo_y=30~-30
                [/teleport_sparkle_1_frame]
                [teleport_sparkle_2_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=0
                    halo_y=40~-40
                [/teleport_sparkle_2_frame]
                [teleport_sparkle_3_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=10
                    halo_y=30~-30
                [/teleport_sparkle_3_frame]
	        
                [frame]
                    image="$current_caster_image.image:[200,100*7]"
                [/frame]
                [frame]
                    image="misc/blank-hex.png:300"
                [/frame]
            [/animation]
	        #--------------------
            # POST-TELEPORT ANIMATION
            #--------------------
            [animation]
	            base_score=-1 # avoid using this animation if any others apply 
                apply_to=post_teleport
                start_time=-1200
	        
                teleport_sparkle_1_start_time=-1200
                teleport_sparkle_2_start_time=-1000
                teleport_sparkle_3_start_time=-800
	        
                [teleport_sparkle_1_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=10
                    halo_y=-30~30
                [/teleport_sparkle_1_frame]
                [teleport_sparkle_2_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=0
                    halo_y=-40~40
                [/teleport_sparkle_2_frame]
                [teleport_sparkle_3_frame]
                    duration=800
                    halo=halo/teleport-[9,8,1~9].png
                    halo_x=-10
                    halo_y=-30~30
                [/teleport_sparkle_3_frame]
                [frame]
                    image="misc/blank-hex.png:300"
                [/frame]
                [frame]
                    image="$current_caster_image.image:[100*7,200]"
                [/frame]
            [/animation]
        [/effect]
    [/object]
	
	{CLEAR_VARIABLE current_caster_image}
	{CLEAR_VARIABLE current_caster_side}
	
    [/event]
#enddef